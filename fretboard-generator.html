<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>指板図ジェネレーター</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background-color: #333;
            color: #e0e0e0;
            font-size: 14px;
        }
        button {
            cursor: pointer;
            background-color: #4a9eff;
            border: none;
            color: white;
        }
        button:hover {
            background-color: #3a8eef;
        }
        #fretboard {
            background-color: #1a1a1a;
            border: 2px solid #444;
            border-radius: 4px;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }
        #fretboard svg {
            max-width: 100%;
            height: auto;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #666;
        }
        .root { background-color: #ff4444; }
        .third { background-color: #4444ff; }
        .fifth { background-color: #44ff44; }
        .seventh { background-color: #ffff44; }
    </style>
</head>
<body>
    <div class="container">
        <h1>指板図ジェネレーター</h1>
        <div class="controls">
            <label>
                コード:
                <select id="chordSelect">
                    <option value="A">A (A, C#, E)</option>
                    <option value="Am">Am (A, C, E)</option>
                    <option value="A7">A7 (A, C#, E, G)</option>
                    <option value="D">D (D, F#, A)</option>
                    <option value="Dm">Dm (D, F, A)</option>
                    <option value="D7">D7 (D, F#, A, C)</option>
                    <option value="E">E (E, G#, B)</option>
                    <option value="Em">Em (E, G, B)</option>
                    <option value="E7">E7 (E, G#, B, D)</option>
                    <option value="G">G (G, B, D)</option>
                    <option value="Gm">Gm (G, Bb, D)</option>
                    <option value="C">C (C, E, G)</option>
                </select>
            </label>
            <label>
                開始フレット:
                <input type="number" id="startFret" value="0" min="0" max="12">
            </label>
            <label>
                終了フレット:
                <input type="number" id="endFret" value="12" min="0" max="24">
            </label>
            <label>
                表示モード:
                <select id="displayMode">
                    <option value="triad">トライアドのみ</option>
                    <option value="seventh">セブンス含む</option>
                    <option value="all">全ポジション</option>
                </select>
            </label>
            <button onclick="generateFretboard()">生成</button>
            <button onclick="downloadSVG()">SVGダウンロード</button>
            <button onclick="downloadPNG()">PNGダウンロード</button>
        </div>
    </div>

    <div class="container">
        <div id="fretboard"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot root"></div>
                <span>ルート</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot third"></div>
                <span>3rd</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot fifth"></div>
                <span>5th</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot seventh"></div>
                <span>7th</span>
            </div>
        </div>
    </div>

    <script>
        // 弦のチューニング（標準チューニング）
        const strings = ['E', 'A', 'D', 'G', 'B', 'E'];
        const stringNotes = [4, 9, 2, 7, 11, 4]; // MIDI note numbers (E2=40, A2=45, etc.)

        // コードトーンの定義
        const chordTones = {
            'A': { root: 'A', third: 'C#', fifth: 'E' },
            'Am': { root: 'A', third: 'C', fifth: 'E' },
            'A7': { root: 'A', third: 'C#', fifth: 'E', seventh: 'G' },
            'D': { root: 'D', third: 'F#', fifth: 'A' },
            'Dm': { root: 'D', third: 'F', fifth: 'A' },
            'D7': { root: 'D', third: 'F#', fifth: 'A', seventh: 'C' },
            'E': { root: 'E', third: 'G#', fifth: 'B' },
            'Em': { root: 'E', third: 'G', fifth: 'B' },
            'E7': { root: 'E', third: 'G#', fifth: 'B', seventh: 'D' },
            'G': { root: 'G', third: 'B', fifth: 'D' },
            'Gm': { root: 'G', third: 'Bb', fifth: 'D' },
            'C': { root: 'C', third: 'E', fifth: 'G' }
        };

        // 音名を半音数に変換
        const noteToSemitone = {
            'C': 0, 'C#': 1, 'Db': 1, 'D': 2, 'D#': 3, 'Eb': 3,
            'E': 4, 'F': 5, 'F#': 6, 'Gb': 6, 'G': 7, 'G#': 8,
            'Ab': 8, 'A': 9, 'A#': 10, 'Bb': 10, 'B': 11
        };

        function getNoteAtPosition(stringIndex, fret) {
            const openNote = stringNotes[stringIndex];
            const semitone = (openNote + fret) % 12;
            const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            return noteNames[semitone];
        }

        function getToneType(note, chord) {
            const tones = chordTones[chord];
            if (!tones) return null;
            if (note === tones.root) return 'root';
            if (note === tones.third) return 'third';
            if (note === tones.fifth) return 'fifth';
            if (tones.seventh && note === tones.seventh) return 'seventh';
            return null;
        }

        function generateFretboard() {
            const chord = document.getElementById('chordSelect').value;
            const startFret = parseInt(document.getElementById('startFret').value);
            const endFret = parseInt(document.getElementById('endFret').value);
            const displayMode = document.getElementById('displayMode').value;
            const tones = chordTones[chord];

            const container = document.getElementById('fretboard');
            container.innerHTML = '';

            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', 'auto');
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            
            const fretCount = endFret - startFret + 1;
            const stringSpacing = 50; // 弦の間隔を大きく
            const fretSpacing = 50;
            const titleY = 25; // コード名のY位置（上に移動）
            const fretNumberY = 45; // フレット番号のY位置（コード名との間隔を広げる）
            const topMargin = 70; // 上部マージン（指板の開始位置）
            const leftMargin = 120; // 左側マージン（弦名用のスペースを増やす）
            const rightMargin = 50;
            const bottomMargin = 30;
            const totalWidth = leftMargin + fretCount * fretSpacing + rightMargin;
            const totalHeight = topMargin + (strings.length - 1) * stringSpacing + bottomMargin;
            
            svg.setAttribute('viewBox', `0 0 ${totalWidth} ${totalHeight}`);

            // フレット線を描画
            for (let f = 0; f <= fretCount; f++) {
                const x = leftMargin + f * fretSpacing;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', topMargin);
                line.setAttribute('x2', x);
                line.setAttribute('y2', topMargin + (strings.length - 1) * stringSpacing);
                line.setAttribute('stroke', '#666');
                line.setAttribute('stroke-width', f === 0 ? '3' : '1');
                svg.appendChild(line);
            }

            // 弦を描画
            for (let s = 0; s < strings.length; s++) {
                const y = topMargin + s * stringSpacing;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', leftMargin);
                line.setAttribute('y1', y);
                line.setAttribute('x2', leftMargin + fretCount * fretSpacing);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#888');
                line.setAttribute('stroke-width', '2.5'); // 弦の太さを少し太く
                svg.appendChild(line);

                // 開放弦の音名（左側に十分なスペースを確保）
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', leftMargin - 30);
                text.setAttribute('y', y + 6);
                text.setAttribute('fill', '#e0e0e0');
                text.setAttribute('font-size', '16');
                text.setAttribute('text-anchor', 'middle');
                text.textContent = strings[s];
                svg.appendChild(text);
            }

            // フレット番号（上部に十分なスペースを確保）
            for (let f = 0; f <= fretCount; f++) {
                const fretNum = startFret + f;
                const x = leftMargin + f * fretSpacing;
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', fretNumberY);
                text.setAttribute('fill', '#888');
                text.setAttribute('font-size', '14');
                text.setAttribute('text-anchor', 'middle');
                text.textContent = fretNum === 0 ? '0' : fretNum;
                svg.appendChild(text);
            }

            // コードトーンを描画
            for (let s = 0; s < strings.length; s++) {
                for (let f = 0; f <= fretCount; f++) {
                    const fretNum = startFret + f;
                    const note = getNoteAtPosition(s, fretNum);
                    const toneType = getToneType(note, chord);

                    if (toneType) {
                        // 表示モードのチェック
                        if (displayMode === 'triad' && toneType === 'seventh') continue;
                        if (displayMode === 'all' || 
                            (displayMode === 'triad' && toneType !== 'seventh') ||
                            (displayMode === 'seventh')) {
                            
                            const x = leftMargin + f * fretSpacing;
                            const y = topMargin + s * stringSpacing;

                            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            circle.setAttribute('cx', x);
                            circle.setAttribute('cy', y);
                            circle.setAttribute('r', '14'); // コードトーンの円を少し大きく
                            
                            const colors = {
                                'root': '#ff4444',
                                'third': '#4444ff',
                                'fifth': '#44ff44',
                                'seventh': '#ffff44'
                            };
                            
                            circle.setAttribute('fill', colors[toneType]);
                            circle.setAttribute('stroke', '#fff');
                            circle.setAttribute('stroke-width', '2');
                            svg.appendChild(circle);

                            // 音名を表示
                            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            text.setAttribute('x', x);
                            text.setAttribute('y', y + 5);
                            text.setAttribute('fill', '#000');
                            text.setAttribute('font-size', '11');
                            text.setAttribute('font-weight', 'bold');
                            text.setAttribute('text-anchor', 'middle');
                            text.textContent = note;
                            svg.appendChild(text);
                        }
                    }
                }
            }

            // コード名を表示
            const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            title.setAttribute('x', totalWidth / 2);
            title.setAttribute('y', titleY);
            title.setAttribute('fill', '#e0e0e0');
            title.setAttribute('font-size', '22');
            title.setAttribute('font-weight', 'bold');
            title.setAttribute('text-anchor', 'middle');
            title.textContent = `${chord} - ${Object.values(tones).join(', ')}`;
            svg.appendChild(title);

            container.appendChild(svg);
        }

        function downloadSVG() {
            const svg = document.querySelector('#fretboard svg');
            if (!svg) return;
            
            const svgData = new XMLSerializer().serializeToString(svg);
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fretboard-${document.getElementById('chordSelect').value}.svg`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadPNG() {
            const svg = document.querySelector('#fretboard svg');
            if (!svg) return;

            const svgData = new XMLSerializer().serializeToString(svg);
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `fretboard-${document.getElementById('chordSelect').value}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };
            
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
        }

        // 初期表示
        generateFretboard();
    </script>
</body>
</html>

